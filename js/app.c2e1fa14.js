(function(){"use strict";var e={8574:function(e,t,s){var a=s(5471),r=s(5668),n=s(6506),i=function(){var e=this,t=e._self._c;return t(r.A,[t("AlertListComponent",{attrs:{alerts:e.alerts}}),t(n.A,[t("router-view")],1)],1)},o=[],l=function(){var e=this,t=e._self._c;return t("TransitionGroup",{staticClass:"alerts",attrs:{name:"alert-list",tag:"div"}},e._l(e.alerts,(function(e){return t("AlertMessage",{key:e.id,attrs:{alert:e}})})),1)},u=[],c=s(1965),d=s(7314),p=s(4414),m=s(2756),h=function(){var e=this,t=e._self._c;return t("div",{staticClass:"alert"},[t(c.A,{attrs:{transition:"scale-transition",prominent:"",type:e.alert.type}},[t(m.A,{attrs:{align:"center"}},[t(p.A,{staticClass:"grow"},[e._v(" "+e._s(e.alert.message)+" ")]),t(p.A,{staticClass:"shrink"},[t(d.A,{on:{click:function(t){return e.$store.dispatch("alert/clear",e.alert.id)}}},[e._v("Закрыть")])],1)],1)],1)],1)},f=[],_={name:"AlertMessage",props:{alert:{type:Object,required:!0}},data(){return{dismissTimeout:null}},created(){this.alert.message?this.dismissTimeout=setTimeout((()=>{this.$store.dispatch("alert/clear",this.alert.id)}),5e3):clearTimeout(this.dismissTimeout)},beforeDestroy(){clearTimeout(this.dismissTimeout)}},g=_,v=s(1656),b=(0,v.A)(g,h,f,!1,null,null,null),y=b.exports,q={name:"alertListComponent",components:{AlertMessage:y},props:{alerts:Array}},w=q,A=(0,v.A)(w,l,u,!1,null,"1fe5533c",null),R=A.exports,x={name:"App",components:{AlertListComponent:R},computed:{alerts(){return this.$store.getters["alert/alerts"]}}},C=x,k=(0,v.A)(C,i,o,!1,null,null,null),$=k.exports,S=s(173),O=function(){var e=this,t=e._self._c;return t("tableComponent",{staticStyle:{"margin-top":"10px"},attrs:{tableData:e.getDataFormService,homeData:e.getHomes}})},D=[],M=s(20),T=s(5006),F=s(7112),H=function(){var e=this,t=e._self._c;return t("div",{staticClass:"table-container"},[t("div",{staticClass:"table__btn"},[t("button",{staticClass:"table__btn-create",on:{click:e.openModalCreate}},[e._v("создать")])]),t("div",{staticClass:"table__filter"},[t(F.A,{attrs:{"hide-details":"auto","append-icon":"mdi-magnify","hide-spin-buttons":"",placeholder:"Поиск (№ заявки, название)"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchMethod.apply(null,arguments)}},model:{value:e.search.request,callback:function(t){e.$set(e.search,"request",t)},expression:"search.request"}}),t(M.A,{attrs:{items:e.getHomes,"item-value":"id","item-text":"full_address",placeholder:"Дом","hide-details":""},model:{value:e.search.premise_id,callback:function(t){e.$set(e.search,"premise_id",t)},expression:"search.premise_id"}})],1),t(m.A,[t(p.A,[t(T.A,{staticClass:"mt-4 table-body",attrs:{headers:e.headers,items:e.tableData,loading:e.loading,"loading-text":"Данные загружаются","item-key":"id",density:"compact","items-per-page":e.itemsPerPage},scopedSlots:e._u([{key:"item.number",fn:function({item:s}){return[t("div",{staticClass:"table-item"},[t("span",{staticClass:"table-body__number",on:{click:function(t){return e.selectRequest(s)}}},[e._v(e._s(s?.number))])])]}},{key:"item.address",fn:function({item:s}){return[t("div",{staticClass:"table-item"},[t("p",[e._v(e._s(s?.premise?.address)+" "+e._s(s?.apartment?.label))])])]}},{key:"item.applicant",fn:function({item:s}){return[t("div",{staticClass:"table-item"},[t("p",[e._v(e._s(s?.applicant?.last_name)+" "+e._s(s?.applicant?.first_name))])])]}},{key:"item.status",fn:function({item:s}){return[t("div",{staticClass:"table-item"},[t("p",[e._v(e._s(s?.status?.name))])])]}}],null,!0)}),t("modalComponent",{attrs:{isOpen:e.isModalOpen,dataRequest:e.dataRequest,isCreate:e.isCreate},on:{closeModal:e.closeModal}})],1)],1)],1)},N=[],P=s(3698),j=s(2938),I=s(4937),L=s(1289),E=s(7683),z=function(){var e=this,t=e._self._c;return t(L.A,{attrs:{value:e.isOpen,"max-width":"800px"},on:{input:e.closeModal}},[t(P.A,{staticClass:"modal"},[t("div",{staticClass:"modal__title"},[t("span",{staticClass:"modal__title-text"},[e._v(e._s(e.isCreate?"Создание заявки":`Заявка № ${e.newRequest?.number} (${e.newRequest?.created_at})`))]),t("span",{staticClass:"modal__title-status"},[e._v(e._s(e.isCreate?"Новая":`${e.newRequest?.status}`))])]),t(j.OQ,{staticClass:"modal__text"},[t(m.A,{staticClass:"d-flex mb-3",staticStyle:{gap:"10px",width:"100%"}},[t(M.A,{attrs:{items:e.getHomes,"item-value":"id","item-text":"full_address",placeholder:"Дом","hide-details":""},model:{value:e.newRequest.premiseId,callback:function(t){e.$set(e.newRequest,"premiseId",t)},expression:"newRequest.premiseId"}}),t(M.A,{attrs:{items:e.getFlats,"item-value":"id","item-text":"label",placeholder:"Квартира","hide-details":"",disabled:!e.getFlats?.length},model:{value:e.newRequest.premiseFlat,callback:function(t){e.$set(e.newRequest,"premiseFlat",t)},expression:"newRequest.premiseFlat"}}),t(E.A,{ref:"menu",attrs:{"close-on-content-click":!1,"nudge-right":40,transition:"scale-transition","offset-y":"","min-width":"290px"},scopedSlots:e._u([{key:"activator",fn:function({on:s,attrs:a}){return[t(F.A,e._g(e._b({attrs:{label:"Срок",readonly:""},model:{value:e.newRequest.dueDate,callback:function(t){e.$set(e.newRequest,"dueDate",t)},expression:"newRequest.dueDate"}},"v-text-field",a,!1),s))]}}]),model:{value:e.menu,callback:function(t){e.menu=t},expression:"menu"}},[t(I.A,{on:{input:function(t){e.menu=!1}},model:{value:e.newRequest.dueDate,callback:function(t){e.$set(e.newRequest,"dueDate",t)},expression:"newRequest.dueDate"}})],1)],1),t(m.A,{staticClass:"d-flex",staticStyle:{gap:"10px",width:"100%"}},[t(F.A,{attrs:{label:"Фамилия"},on:{input:e.performSearch},model:{value:e.newRequest.lastName,callback:function(t){e.$set(e.newRequest,"lastName",t)},expression:"newRequest.lastName"}}),t(F.A,{attrs:{label:"Имя"},on:{input:e.performSearch},model:{value:e.newRequest.firstName,callback:function(t){e.$set(e.newRequest,"firstName",t)},expression:"newRequest.firstName"}}),t(F.A,{attrs:{label:"Отчество"},on:{input:e.performSearch},model:{value:e.newRequest.patronymicName,callback:function(t){e.$set(e.newRequest,"patronymicName",t)},expression:"newRequest.patronymicName"}}),t(F.A,{attrs:{label:"Телефон"},on:{input:e.performSearch},model:{value:e.newRequest.phone,callback:function(t){e.$set(e.newRequest,"phone",t)},expression:"newRequest.phone"}})],1),t(F.A,{staticClass:"modal__field-description",attrs:{label:"Описание заявки"},on:{input:e.performSearch},model:{value:e.newRequest.description,callback:function(t){e.$set(e.newRequest,"description",t)},expression:"newRequest.description"}})],1),t("div",{staticClass:"modal__btn"},[e.isCreate?t("button",{staticClass:"modal__btn-create",on:{click:e.createRequest}},[e._v("Создать")]):t("button",{staticClass:"modal__btn-create",on:{click:e.saveRequest}},[e._v("Сохранить")])])],1)],1)},B=[],Q={data(){return{}},computed:{getFlats(){return this.$store.getters["request/getFlats"]},getHomes(){return this.$store.getters["request/getHomes"]}},methods:{setHome(e){return this.$store.dispatch("request/setFlat",{homeId:e})}}},V={name:"modalComponent",props:{isOpen:{type:Boolean},dataRequest:{type:Object||null},isCreate:{type:Boolean}},data(){return{newRequest:{premiseId:"",premiseFlat:"",dueDate:"",lastName:"",firstName:"",patronymicName:"",phone:"",description:""},searchTerm:"",search:{premiseId:{}},premise:[],flats:[],menu:!1}},mixins:[Q],computed:{getDataToSend(){return{id:this.newRequest.id,premise_id:this.newRequest.premiseId,apartment_id:this.newRequest.premiseFlat,applicant:{last_name:this.newRequest.lastName,first_name:this.newRequest.firstName,patronymic_name:this.newRequest.patronymicName},username:this.newRequest.phone,description:this.newRequest.description,due_date:this.newRequest.dueDate}}},methods:{performSearch(){},closeModal(){this.$emit("closeModal")},createRequest(){this.$store.dispatch("request/createRequest",this.getDataToSend),this.closeModal()},saveRequest(){this.$store.dispatch("request/saveRequest",this.getDataToSend),this.closeModal()}},watch:{dataRequest(e){e&&(this.newRequest=e)},"newRequest.premiseId":{handler:function(e,t){e&&e!==t&&this.setHome(e)},deep:!0}}},G=V,Y=(0,v.A)(G,z,B,!1,null,null,null),Z=Y.exports,J={props:{tableData:{type:Array},homeData:{type:Array}},components:{modalComponent:Z},mixins:[Q],data(){return{itemsPerPage:10,headers:[{text:"№",value:"number",class:"table-header",sortable:!0},{text:"Создана",value:"created_at",class:"table-header",sortable:!0},{text:"Адресс",value:"address",class:"table-header",sortable:!1},{text:"Заявитель",value:"applicant",class:"table-header",sortable:!1},{text:"Описание",value:"description",class:"table-header",sortable:!1},{text:"Срок",value:"due_date",class:"table-header",sortable:!0},{text:"Статус",value:"status",class:"table-header",sortable:!0}],search:{premise_id:"",request:""},premise:[],isModalOpen:!1,dataRequest:null,isCreate:!0}},computed:{loading(){return!this.tableData?.length}},methods:{searchMethod(){console.log("search")},openModal(){this.isCreate=!1,this.isModalOpen=!0},closeModal(){this.isModalOpen=!1},openModalCreate(){this.isCreate=!0,this.isModalOpen=!0,this.dataRequest={}},selectRequest(e){this.dataRequest={id:e.id,number:e?.number,created_at:e?.created_at,premiseId:e?.premise?.id,status:e?.status?.name,premiseFlat:e?.apartment?.id,dueDate:e?.due_date,lastName:e?.applicant?.last_name,firstName:e?.applicant?.first_name,patronymicName:e?.applicant?.patronymic_name,phone:e?.premise?.locality?.phone_code1??" "+e?.premise?.locality?.phone_code2??"",description:e?.description},this.openModal()}}},K=J,U=(0,v.A)(K,H,N,!1,null,"ff618824",null),W=U.exports,X={name:"HomePage",components:{tableComponent:W},computed:{env(){return"/mdo_test/"},getDataFormService(){return this.$store.getters["request/getRequests"]},getHomes(){return this.$store.getters["request/getHomes"]}},methods:{setData(){this.$store.dispatch("request/setRequests")},setHomes(){this.$store.dispatch("request/setHomes")},loadData(){this.setData(),this.setHomes()}},created(){this.loadData()}},ee=X,te=(0,v.A)(ee,O,D,!1,null,"6da64d63",null),se=te.exports,ae=s(4566),re=s(174),ne=function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-page"},[t(ae.A,{staticClass:"login-page__container",attrs:{fluid:""}},[t(m.A,{staticStyle:{height:"100vh"},attrs:{justify:"center",align:"center"}},[t(p.A,{attrs:{cols:"12",md:"4"}},[t(P.A,[t("div",{staticClass:"login-page__container__title"},[t("span",{staticClass:"text-center"},[e._v("Авторизация")])]),t(j.OQ,{staticClass:"login-page__container__text"},[t(re.A,{ref:"loginForm",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[t(F.A,{attrs:{label:"Логин или телефон",rules:[e.rules.required],"prepend-icon":"mdi-account"},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),t(F.A,{attrs:{label:"Пароль",type:e.showPassword?"text":"password","append-icon":e.showPassword?"mdi-eye":"mdi-eye-off",rules:[e.rules.required],"prepend-icon":"mdi-lock"},on:{"click:append":e.togglePasswordVisibility},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1),t(j.SL,{staticClass:"justify-center login-page__container__action"},[t(d.A,{staticClass:"login-page__container__action__btn",on:{click:e.login}},[e._v("Войти")])],1)],1)],1)],1)],1)],1)},ie=[],oe=(s(4114),s(4335));const le="https://dev.moydomonline.ru/api",ue=async(e,t)=>{try{const s=await oe.A.post(le+"/auth/login/",{username:e,password:t});if(200===s?.status){const e=s.data.key;return localStorage.setItem("authToken",e),oe.A.defaults.headers.common["Authorization"]=`Token ${e}`,!0}return console.error("Error during login, status is: ",s?.status),!1}catch(s){return console.error("Error during login:",s),!1}};oe.A.interceptors.request.use((e=>{const t=localStorage.getItem("authToken");return t&&(e.headers["Authorization"]=`Token ${t}`),e}),(e=>Promise.reject(e)));const ce=async()=>{const e=await oe.A.get(le+"/appeals/v1.0/appeals");return e.data.results},de=async()=>{const e=await oe.A.get(le+"/geo/v2.0/user-premises/");return e.data.results},pe=async e=>{const t=await oe.A.get(le+`/geo/v1.0/apartments/?premise_id=${e}`);return t.data.results},me=async e=>{try{const t=await oe.A.post(le+"/appeals/v1.0/appeals/",e);return t}catch(t){return t.response.data.data}},he=async e=>{try{const t=await oe.A.patch(le+`/appeals/v1.0/appeals/${e.id}/`,e);return t}catch(t){return t.response.data.data}};var fe={name:"LoginPage",data(){return{username:"",password:"",showPassword:!1,valid:!1,rules:{required:e=>!!e||"Поле обязательно для заполнения"}}},methods:{async login(){if(this.$refs.loginForm.validate()){const e=await ue(this.username,this.password);e&&this.$router.push({path:"/"})}else console.log("Форма невалидна")},togglePasswordVisibility(){this.showPassword=!this.showPassword}}},_e=fe,ge=(0,v.A)(_e,ne,ie,!1,null,"826b85ce",null),ve=ge.exports;const be=()=>!!localStorage.getItem("authToken");var ye=be;a.Ay.use(S.Ay);const qe=new S.Ay({mode:"history",routes:[{path:"/",name:"Home",component:se},{path:"/login",name:"Login",component:ve}]});qe.beforeEach(((e,t,s)=>{ye()||"/login"===e.path?s():s({path:"/login"})}));var we=qe,Ae=s(5353);const Re={namespaced:!0,state:{alerts:[]},getters:{alerts:e=>e.alerts},mutations:{success(e,t){const s=Date.now();e.alerts.push({type:"success",message:t,id:s})},error(e,t){const s=Date.now();e.alerts.push({type:"error",message:t,id:s})},clear(e,t){e.alerts=e.alerts.filter((e=>e.id!==t))}},actions:{success({commit:e},t){e("success",t)},error({commit:e},t){e("error",t)},clear({commit:e},t){e("clear",t)}}},xe=e=>{const t=new Date(e),s=String(t.getDate()).padStart(2,"0"),a=String(t.getMonth()+1).padStart(2,"0"),r=t.getFullYear();return`${r}-${a}-${s}`},Ce=e=>{const[t,s,a]=e.split("-"),r=new Date(`${t}-${s}-${a}T00:00:00Z`);return r.toISOString()},ke={namespaced:!0,state:{requests:[],homes:[],flats:[]},mutations:{setRequests(e,t){e.requests=t},setHomes(e,t){e.homes=t},setFlats(e,t){e.flats=t},addRequest(e,t){e.requests.unshift(t)},updateRequest(e,t){e.requests=e.requests.filter((e=>e.id!==t.id)),e.requests.unshift(t)}},actions:{async setRequests({commit:e,getters:t}){if(t.getRequests.length)return;const s=await ce();s.map((e=>(e.created_at=xe(e.created_at),e.due_date=xe(e.due_date),e))),e("setRequests",s)},async setHomes({commit:e}){const t=await de();e("setHomes",t)},async setFlat({commit:e},{homeId:t}){if(!t)return $e.dispatch("alert/error","Дом не указан");const s=await pe(t);e("setFlats",s)},async createRequest({commit:e},t){const s=await me({...t,due_date:Ce(t.due_date),status_id:1});if(201===s?.status){$e.dispatch("alert/success","Заявка успешно создана");const t=s.data;t.created_at=xe(t.created_at),t.due_date=xe(t.due_date),e("addRequest",t)}else for(let a=0;a<Object.keys(s).length;a++)s[Object.keys(s)[a]].map((e=>$e.dispatch("alert/error","Не удалось создать: "+e)))},async saveRequest({commit:e},t){const s=await he({...t,due_date:Ce(t.due_date)});if(200===s?.status){$e.dispatch("alert/success","Заявка успешно отредактирована");const t=s.data;t.created_at=xe(t.created_at),t.due_date=xe(t.due_date),e("updateRequest",t)}else for(let a=0;a<Object.keys(s).length;a++)s[Object.keys(s)[a]].map((e=>$e.dispatch("alert/error","Не удалось обновить: "+e)))}},getters:{getRequests:e=>e.requests,getHomes:e=>e.homes,getFlats:e=>e.flats}};a.Ay.use(Ae.Ay);var $e=new Ae.Ay.Store({modules:{alert:Re,request:ke}}),Se=s(3971);a.Ay.use(Se.A);var Oe=new Se.A({});a.Ay.config.productionTip=!1,new a.Ay({render:e=>e($),router:we,vuetify:Oe,store:$e}).$mount("#app")}},t={};function s(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a].call(n.exports,n,n.exports,s),n.exports}s.m=e,function(){var e=[];s.O=function(t,a,r,n){if(!a){var i=1/0;for(c=0;c<e.length;c++){a=e[c][0],r=e[c][1],n=e[c][2];for(var o=!0,l=0;l<a.length;l++)(!1&n||i>=n)&&Object.keys(s.O).every((function(e){return s.O[e](a[l])}))?a.splice(l--,1):(o=!1,n<i&&(i=n));if(o){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[a,r,n]}}(),function(){s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,{a:t}),t}}(),function(){s.d=function(e,t){for(var a in t)s.o(t,a)&&!s.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){s.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};s.O.j=function(t){return 0===e[t]};var t=function(t,a){var r,n,i=a[0],o=a[1],l=a[2],u=0;if(i.some((function(t){return 0!==e[t]}))){for(r in o)s.o(o,r)&&(s.m[r]=o[r]);if(l)var c=l(s)}for(t&&t(a);u<i.length;u++)n=i[u],s.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return s.O(c)},a=self["webpackChunkmdo_test"]=self["webpackChunkmdo_test"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=s.O(void 0,[504],(function(){return s(8574)}));a=s.O(a)})();
//# sourceMappingURL=app.c2e1fa14.js.map